import telebot
from flask import Flask
from telebot import types
import pytz
from datetime import datetime
import logging
import threading
from convertdate import persian

# ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
bot_token = "8130259539:AAGkZzGrO9Ni_1-yNkJDp-m6JzLDD-6nNgI"
bot = telebot.TeleBot(bot_token)

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Flask
app = Flask(__name__)

# Ø²Ù…Ø§Ù†â€ŒØ´Ù†Ø§Ø³ÛŒ Ø¨Ø§ pytz
timezone = pytz.timezone('Asia/Tehran')

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù„Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯
logging.basicConfig(level=logging.INFO)

# Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§ÛŒ ØªÛŒÙ…
members = [
    "Ù…Ø­Ù…Ø¯ Ù…Ù‡Ø¯ÛŒ Ø¨Ø±Ø²Ú¯Ø±",
    "Ø§Ù…ÛŒØ± Ø­Ø³ÛŒÙ† Ø®Ø³Ø±ÙˆÛŒ",
    "Ù…Ø±ÛŒÙ… Ø§Ø·Ù…ÛŒÙ†Ø§Ù†",
    "Ø­Ø³ÛŒÙ† Ø¨ÛŒÚ¯Ø¯Ù„ÛŒ"
]

# Ø§Ø³Ø§Ù…ÛŒ Ø§Ø³ØªØ§Ø¯ÛŒ Ú©Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø®Ø§Øµ Ø¯Ø§Ø±Ù†Ø¯
professors = ["Ù¾Ø±ÛŒØ³Ø§ Ø±Ø²Ø§Ù‚ÛŒ", "Ø±Ø²Ø§Ù‚ÛŒ", "Ù¾Ø±ÛŒØ³Ø§", "Ø§Ø³ØªØ§Ø¯"]

# Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø±
user_state = {}

# ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ù‡ Ù‡Ø¬Ø±ÛŒ Ø´Ù…Ø³ÛŒ
def get_persian_date():
    # ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ Ù…ÛŒÙ„Ø§Ø¯ÛŒ
    now = datetime.now(timezone)

    # ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ù‡ Ù‡Ø¬Ø±ÛŒ Ø´Ù…Ø³ÛŒ
    persian_date = persian.from_gregorian(now.year, now.month, now.day)

    # Ø¨Ø§Ø²Ú¯Ø´Øª ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ø¨Ù‡ ÙØ±Ù…Øª Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø§ Ø³Ø§Ø¹Øª
    persian_time = now.strftime('%H:%M:%S')  # Ø³Ø§Ø¹Øª Ø¯Ù‚ÛŒÙ‚
    return f"{persian_date[0]}-{persian_date[1]:02d}-{persian_date[2]:02d} {persian_time}"

# ØªØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ù…Ø§Ù„Ú© Ø±Ø¨Ø§Øª
def send_to_owner(message, is_authorized, user_choice=None, user_name=None):
    owner_id = 6725646874  # Ø´Ù†Ø§Ø³Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ù…Ø§Ù„Ú© Ø±Ø¨Ø§Øª

    # Ø§Ú¯Ø± Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
    user_info = f"""
    Ú©Ø§Ø±Ø¨Ø± {message.from_user.first_name} ({message.from_user.id}) Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ú©Ø±Ø¯.
    """

    # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯)
    if user_name:
        user_info += f"\nÙ†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø±: {user_name}"

    # ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ Ø³Ø§Ø¹Øª
    persian_date = get_persian_date()

    # Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÛŒ
    user_info += f"""
    Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…: {message.from_user.last_name if message.from_user.last_name else 'N/A'}
    Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ: {message.from_user.id}
    Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…: {message.from_user.username if message.from_user.username else 'N/A'}
    Ø²Ø¨Ø§Ù†: {message.from_user.language_code}
    Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…: {persian_date}   
    Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²Ø¯ÛŒØ¯ : {persian_date}
    """

    # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ù…Ø§Ù„Ú©
    if isinstance(message, types.Message):
        if message.text:
            bot.send_message(owner_id, f"{user_info}\nÙ…ØªÙ† Ù¾ÛŒØ§Ù…: {message.text}")
            if user_choice:
                bot.send_message(owner_id, f"Ú©Ø§Ø±Ø¨Ø± Ú¯Ø²ÛŒÙ†Ù‡ Ø²ÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯: {user_choice}")
        elif message.photo:
            bot.send_message(owner_id, f"{user_info}\nØ¹Ú©Ø³ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")
            photo_id = message.photo[-1].file_id
            try:
                bot.send_photo(owner_id, photo_id)
            except Exception as e:
                bot.send_message(owner_id, f"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³: {str(e)}")
        elif message.video:
            bot.send_message(owner_id, f"{user_info}\nÙˆÛŒØ¯Ø¦Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")
            bot.send_video(owner_id, message.video.file_id)
        elif message.audio:
            bot.send_message(owner_id, f"{user_info}\nØ¢Ù‡Ù†Ú¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")
            bot.send_audio(owner_id, message.audio.file_id)
        elif message.document:
            bot.send_message(owner_id, f"{user_info}\nÙØ§ÛŒÙ„ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")
            bot.send_document(owner_id, message.document.file_id)
        elif message.voice:
            bot.send_message(owner_id, f"{user_info}\nÙ¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")
            bot.send_voice(owner_id, message.voice.file_id)
        elif message.sticker:
            bot.send_message(owner_id, f"{user_info}\nØ§Ø³ØªÛŒÚ©Ø± Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")
            bot.send_sticker(owner_id, message.sticker.file_id)
        else:
            bot.send_message(owner_id, f"{user_info}\nÙ¾ÛŒØ§Ù… Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")

# Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø²Ù…Ø§Ù† Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
@bot.message_handler(commands=['start'])
def send_welcome(message):
    if user_state.get(message.chat.id) == 'blocked':
        bot.send_message(message.chat.id, "Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ù†Ø¯Ø§Ø±ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ù…Ø¯ÛŒØ± ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.")
        user_state[message.chat.id] = 'waiting_for_name'  # Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø² Ø§ÙˆÙ„
        bot.send_message(message.chat.id, "Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ù‡ÛŒÙ….")
        bot.register_next_step_handler(message, ask_name)
        return

    user_state[message.chat.id] = 'waiting_for_name'
    bot.send_message(message.chat.id, "Ø¯Ø±ÙˆØ¯ Ø¨Ø± Ø´Ù…Ø§! Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ù‡ÛŒÙ….")
    bot.register_next_step_handler(message, ask_name)

# ØªØ§Ø¨Ø¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†Ø§Ù… Ø§Ø² Ú©Ø§Ø±Ø¨Ø±
def ask_name(message):
    name = message.text.strip()

    if name == "Ù…Ø±ÛŒÙ… Ø§Ø·Ù…ÛŒÙ†Ø§Ù†":
        bot.send_message(message.chat.id, """
Ø§Ø³Ù…Ø§ Ø§Ø² Ø²Ø­Ù…Ø§ØªØª Ø¨Ù‡ Ø´Ø¯Øª Ù…Ù…Ù†ÙˆÙ†ÛŒÙ… Ø§Ø² ÙˆÙ‚Øª Ø®ÛŒÙ„ÛŒ Ø®ÛŒÙ„ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ú©Ù‡ Ú¯Ø°Ø§Ø´ØªÛŒ Ø§Ø² ØªØ­Ù‚ÛŒÙ‚ Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ú©Ø±Ø¯ÛŒ ğŸ˜‚ ğŸ˜‚ğŸ˜‚
        """)
        send_to_owner(message, is_authorized=True, user_choice="Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡: " + name, user_name=name)
        user_state[message.chat.id] = 'in_main_menu'
        show_main_menu(message)
    elif name == "Ù…Ø­Ù…Ø¯ Ù…Ù‡Ø¯ÛŒ Ø¨Ø±Ø²Ú¯Ø±":
        bot.send_message(message.chat.id, """
thay is shayan. how can you help your self
        """)
        send_to_owner(message, is_authorized=True, user_choice="Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡: " + name, user_name=name)
        user_state[message.chat.id] = 'in_main_menu'
        show_main_menu(message)
    elif name in members:
        bot.send_message(message.chat.id, f"Ø³Ù„Ø§Ù… {name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯.")
        send_to_owner(message, is_authorized=True, user_choice="Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡: " + name, user_name=name)
        user_state[message.chat.id] = 'in_main_menu'
        show_main_menu(message)
    elif name in professors:
        bot.send_message(message.chat.id, """
Ø³Ù„Ø§Ù… Ø§Ø³ØªØ§Ø¯ Ø¹Ø²ÛŒØ² ğŸ“

Ø®ÙˆØ´Ø­Ø§Ù„ÛŒÙ… Ú©Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒ Ø´Ù…Ø§ Ø¨ÙˆØ¯ÛŒÙ… Ùˆ ÙØ±ØµØª ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø§Ø² Ø´Ù…Ø§ Ø±Ø§ Ø¯Ø§Ø´ØªÛŒÙ…. 
Ø²Ø­Ù…Ø§Øª Ùˆ Ø¯Ø§Ù†Ø´ Ø´Ù…Ø§ Ù‡Ù…ÙˆØ§Ø±Ù‡ Ú©Ù…Ú© Ú©Ù†Ù†Ø¯Ù‡ Ù…Ø§ Ø¨ÙˆØ¯Ù‡ Ùˆ Ø§Ù…ÛŒØ¯ÙˆØ§Ø±ÛŒÙ… Ø¯Ø± Ø¯Ø±Ø³ Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ù†ÛŒØ² Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒ Ø´Ù…Ø§ Ø¨Ø§Ø´ÛŒÙ…..

Ø¨Ø§ Ø¢Ø±Ø²ÙˆÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ØŒ
Ù…Ø­Ù…Ø¯ Ù…Ù‡Ø¯ÛŒ Ø¨Ø±Ø²Ú¯Ø±, Ù…Ø±ÛŒÙ… Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
Ø¨Ù‡ Ø¬Ø² Ø§Ù…ÛŒØ± Ø­Ø³ÛŒÙ† Ø®Ø³Ø±ÙˆÛŒ Ùˆ Ø­Ø³ÛŒÙ† Ø¨ÛŒÚ¯Ø¯Ù„ÛŒ
        """)
        send_to_owner(message, is_authorized=True, user_choice="Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡: " + name, user_name=name)
        user_state[message.chat.id] = 'in_main_menu'
        show_main_menu(message)
    else:
        bot.send_message(message.chat.id, "Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ù†Ø¯Ø§Ø±ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ù…Ø¯ÛŒØ± ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.")
        send_to_owner(message, is_authorized=False, user_choice="Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡: " + name, user_name=name)
        user_state[message.chat.id] = 'blocked'

# Ù†Ù…Ø§ÛŒØ´ Ù…Ù†Ùˆ Ø§ØµÙ„ÛŒ
def show_main_menu(message):
    if user_state.get(message.chat.id) == 'blocked':
        return

    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True, row_width=1)
    button1 = types.KeyboardButton("Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§")
    button2 = types.KeyboardButton("Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§")
    markup.add(button1, button2)

    bot.send_message(message.chat.id, "Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:", reply_markup=markup)

# Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ú¯Ø²ÛŒÙ†Ù‡ "Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§"
@bot.message_handler(func=lambda message: message.text == "Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§")
def send_projects(message):
    send_to_owner(message, is_authorized=True, user_choice="Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§", user_name=None)
    if user_state.get(message.chat.id) == 'blocked':
        return

    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True, row_width=1)
    button1 = types.KeyboardButton("Ø³Ø§Ø®ØªÙ† Ø´Ø¨Ú©Ù‡")
    button2 = types.KeyboardButton("Ø§Ù†ÙˆØ§Ø¹ ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù…Ø²Ø§ÛŒØ§ Ùˆ Ù…Ø¹Ø§ÛŒØ¨")
    button3 = types.KeyboardButton("Ø­Ø¯Ø§Ù‚Ù„ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ ÙˆÛŒÙ†Ø¯ÙˆØ² 10")
    button4 = types.KeyboardButton("Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Word")
    button_back = types.KeyboardButton("Ø¨Ø§Ø²Ú¯Ø´Øª")

    markup.add(button1, button2, button3, button4, button_back)
    bot.send_message(message.chat.id, "Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:", reply_markup=markup)

# Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
def send_file(message, file_path):
    try:
        with open(file_path, 'rb') as file:
            bot.send_document(message.chat.id, file)
    except Exception as e:
        bot.send_message(message.chat.id, f"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„: {str(e)}")

@bot.message_handler(func=lambda message: message.text == "Ø³Ø§Ø®ØªÙ† Ø´Ø¨Ú©Ù‡")
def send_file1(message):
    send_to_owner(message, is_authorized=True, user_choice="Ø³Ø§Ø®ØªÙ† Ø´Ø¨Ú©Ù‡", user_name=None)
    send_file(message, 'files/part5.pdf')

@bot.message_handler(func=lambda message: message.text == "Ø§Ù†ÙˆØ§Ø¹ ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù…Ø²Ø§ÛŒØ§ Ùˆ Ù…Ø¹Ø§ÛŒØ¨")
def send_file2(message):
    send_to_owner(message, is_authorized=True, user_choice="Ø§Ù†ÙˆØ§Ø¹ ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù…Ø²Ø§ÛŒØ§ Ùˆ Ù…Ø¹Ø§ÛŒØ¨", user_name=None)
    send_file(message, 'files/screen.pdf')

@bot.message_handler(func=lambda message: message.text == "Ø­Ø¯Ø§Ù‚Ù„ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ ÙˆÛŒÙ†Ø¯ÙˆØ² 10")
def send_file3(message):
    send_to_owner(message, is_authorized=True, user_choice="Ø­Ø¯Ø§Ù‚Ù„ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ ÙˆÛŒÙ†Ø¯ÙˆØ² 10", user_name=None)
    send_file(message, 'files/windows10.pdf')

@bot.message_handler(func=lambda message: message.text == "Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Word")
def send_word_file(message):
    send_to_owner(message, is_authorized=True, user_choice="Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Word", user_name=None)
    send_file(message, 'files/word_file.pdf')

# Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ú¯Ø²ÛŒÙ†Ù‡ "Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§"
@bot.message_handler(func=lambda message: message.text == "Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§")
def send_team_list(message):
    send_to_owner(message, is_authorized=True, user_choice="Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§", user_name=None)
    if user_state.get(message.chat.id) == 'blocked':
        return

    for idx, member in enumerate(members, start=1):
        bot.send_message(message.chat.id, f"{idx}. {member}")

    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True, row_width=1)
    button_back = types.KeyboardButton("Ø¨Ø§Ø²Ú¯Ø´Øª")
    markup.add(button_back)

    bot.send_message(message.chat.id, "Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒØŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯:", reply_markup=markup)

# Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª
@bot.message_handler(func=lambda message: message.text == "Ø¨Ø§Ø²Ú¯Ø´Øª")
def handle_back_button(message):
    send_to_owner(message, is_authorized=True, user_choice="Ø¨Ø§Ø²Ú¯Ø´Øª", user_name=None)
    if user_state.get(message.chat.id) == 'blocked':
        return

    show_main_menu(message)

# Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ø§Ø±Ø³Ø§Ù„ Ù‡Ø± Ù†ÙˆØ¹ Ù¾ÛŒØ§Ù… Ø§Ø² Ú©Ø§Ø±Ø¨Ø±
@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    send_to_owner(message, is_authorized=True, user_choice=None, user_name=None)

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø±Ø¨Ø§Øª Ø¨Ø§ polling Ø¯Ø± ÛŒÚ© Ù†Ø® Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡
def run_bot():
    bot.polling(none_stop=True)

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Flask
@app.route('/')
def index():
    return "Ø³Ù„Ø§Ù…! Ø±Ø¨Ø§Øª Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª."

# Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª Ùˆ Ø³Ø±ÙˆØ± Flask
if __name__ == "__main__":
    threading.Thread(target=run_bot).start()
    app.run(host="0.0.0.0", port=5000)
